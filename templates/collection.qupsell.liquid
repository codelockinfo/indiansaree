{%- layout none -%}
{%- assign limit = 100 -%}
{%- capture contentForQuerystring -%}{{ content_for_header }}{%- endcapture -%}
{%- assign pageUrl = contentForQuerystring | split:'"pageurl":"' | last | split:'"' | first | split:'.myshopify.com' | last | replace:'\/','/' | replace:'%20',' ' | replace:'\u0026','&' -%}
{% assign pageUrlArr = pageUrl | split: "limit=" %}
{% capture pageTypeStr %}{{ pageUrlArr[1] | json }}{% endcapture %}
{% if pageTypeStr contains '"' %}{%- assign limit = pageUrlArr[1] -%}{% else %}{% endif %}
{
  "collectionId": {{collection.id}},
  "productArr": {
    {% paginate collection.products by limit %}
    {% for product in collection.products %}
        "{{ forloop.index }}" : {{product | json }}{%- if forloop.index != collection.products.length -%},{%-endif-%}
    {% endfor %}
    {% endpaginate %}
  }
}